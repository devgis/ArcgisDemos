
<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
  <title>Buffer</title>
  
  <!--
  <link rel="stylesheet" href="http://192.168.0.106:6088/3.9/js/dojo/dijit/themes/claro/claro.css">
<link rel="stylesheet" href="http://192.168.0.106:6088/3.9/js/esri/css/esri.css">


<script src="http://192.168.0.106:6088/3.9/init.js"></script>
-->

<link rel="stylesheet" href="http://192.168.0.106:6088/3.16/dijit/themes/claro/claro.css">
<link rel="stylesheet" href="http://192.168.0.106:6088/3.16/esri/css/esri.css">
<script src="http://192.168.0.106:6088/3.16/init.js"></script>
  <script>
    dojo.require("esri.map");
    dojo.require("esri.tasks.geometry");
    //dojo.require("esri.layers.ArcGISDynamicMapServiceLayer");

    var map = null;
    var gsvc = null;
var layer;

    
    
    function initialize() {
        
        
   
    
      map = new esri.Map("map", {
        //basemap: "streets",
        //center: [108.352, 32.872],
        //zoom: 9
      });
      
      
       var mapServiceUrl = "http://192.168.0.106:6080/arcgis/rest/services/ShaanXi/MapServer"; //sx
    layer = new esri.layers.ArcGISDynamicMapServiceLayer(mapServiceUrl); //动态地图地址
    map.addLayer(layer);
    
    //map.spatialReference=new esri.SpatialReference({
    //    "wkid": 4326
    //});
      
      
      
      //http://192.168.0.106:6080/arcgis/rest/services/Utilities/Geometry/GeometryServer
       //gsvc = new esri.tasks.GeometryService("https://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");

      gsvc = new esri.tasks.GeometryService("http://192.168.0.106:6080/arcgis/rest/services/Utilities/Geometry/GeometryServer");
 
      map.on("click", doBuffer);

    }

    function doBuffer(evt) {

      //map.graphics.clear();
      //var params = new esri.tasks.BufferParameters();
      //params.geometries = [ evt.mapPoint ];

      //buffer in linear units such as meters, km, miles etc.
      //params.distances = [ 5, 10 ];
      //params.distances = [ 10 ];
      //params.unit ="UNIT_METER";//esri.tasks.GeometryService.UNIT_KILOMETER;
      //params.outSpatialReference = map.spatialReference;

      //gsvc.buffer(params, showBuffer);
      
      
      require([
        "esri/tasks/BufferParameters", "esri/SpatialReference", "dojo/dom", 
        "esri/tasks/GeometryService" 
        ], function(BufferParameters, SpatialReference, dom, GeometryService ) {
            var params = new BufferParameters();
            params.geometries  = [ evt.mapPoint ];
            
            params.distances = [ 0.1];
            //params.unit =GeometryService.UNIT_METER;//esri.tasks.GeometryService.UNIT_KILOMETER; //如果是经纬度 就不能增加单位
            params.outSpatialReference = map.spatialReference;
        
            params.bufferSpatialReference = new SpatialReference({wkid: 4326});
            gsvc.buffer(params, showBuffer);
        });
    }

    function showBuffer(geometries) {
        
       // alert(geometries.length);
       // return;
        
      var symbol = new esri.symbol.SimpleFillSymbol(
        esri.symbol.SimpleFillSymbol.STYLE_SOLID,
        new esri.symbol.SimpleLineSymbol(
          esri.symbol.SimpleLineSymbol.STYLE_SOLID,
          new dojo.Color([0,0,255,0.65]), 2
        ),
        new dojo.Color([0,0,255,0.35])
      );

      dojo.forEach(geometries, function(geometry) {
        var graphic = new esri.Graphic(geometry,symbol);
        map.graphics.add(graphic);
      });
    }

    dojo.ready(initialize);
  </script>
</head>

<body class="claro">
  <b>Click a location on the map to buffer. Click again on another location to buffer again.</b>
  <div id="map" style="width:600px; height:400px; border:1px solid #000;"></div>
</body>

</html>
